<html><head><title>Kernel::System::ObjectManager</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.28,
  using Pod::Simple::PullParser v3.28,
  under Perl v5.018002 at Sat Oct 10 15:08:55 2015 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#How_does_it_work%3F'>How does it work?</a>
    <li class='indexItem indexItem2'><a href='#How_to_use_it%3F'>How to use it?</a>
    <li class='indexItem indexItem2'><a href='#Which_objects_can_be_loaded%3F'>Which objects can be loaded?</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#PUBLIC_INTERFACE'>PUBLIC INTERFACE</a>
  <li class='indexItem indexItem1'><a href='#TERMS_AND_CONDITIONS'>TERMS AND CONDITIONS</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Kernel::System::ObjectManager - object and dependency manager</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p>The ObjectManager is the central place to create and access singleton OTRS objects.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="How_does_it_work?"
>How does it work?</a></h2>

<p>It creates objects as late as possible and keeps references to them.
Upon destruction the objects are destroyed in the correct order,
based on their dependencies (see below).</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="How_to_use_it?"
>How to use it?</a></h2>

<p>The ObjectManager must always be provided to OTRS by the toplevel script like this:</p>

<pre>    use Kernel::System::ObjectManager;
    local $Kernel::OM = Kernel::System::ObjectManager-&#62;new(
        # options for module constructors here
        LogObject {
            LogPrefix =&#62; &#39;OTRS-MyTestScript&#39;,
        },
    );</pre>

<p>Then in the code any object can be retrieved that the ObjectManager can handle, like Kernel::System::DB:</p>

<pre>    return if !$Kernel::OM-&#62;Get(&#39;Kernel::System::DB&#39;)-&#62;Prepare(&#39;SELECT 1&#39;);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Which_objects_can_be_loaded?"
>Which objects can be loaded?</a></h2>

<p>The ObjectManager can load every object that declares its dependencies like this in the Perl package:</p>

<pre>    package Kernel::System::Valid;

    use strict;
    use warnings;

    our @ObjectDependencies = (
        &#39;Kernel::System::Cache&#39;,
        &#39;Kernel::System::DB&#39;,
        &#39;Kernel::System::Log&#39;,
    );</pre>

<p>The <code>@ObjectDependencies</code> is the list of objects that the current object will depend on. They will be destroyed only after this object is destroyed.</p>

<p>If you want to signal that a package can NOT be loaded by the ObjectManager, you can use the <code>$ObjectManagerDisabled</code> flag:</p>

<pre>    package Kernel::System::MyBaseClass;

    use strict;
    use warnings;

    $ObjectManagerDisabled = 1;</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PUBLIC_INTERFACE"
>PUBLIC INTERFACE</a></h1>

<dl>
<dt><a name="new()"
>new()</a></dt>

<dd>
<p>Creates a new instance of Kernel::System::ObjectManager.</p>

<pre>    use Kernel::System::ObjectManager;
    local $Kernel::OM = Kernel::System::ObjectManager-&#62;new();</pre>

<p>Sometimes objects need parameters to be sent to their constructors, these can also be passed to the ObjectManager&#39;s constructor like in the following example. The hash reference will be flattened and passed to the constructor of the object(s).</p>

<pre>    local $Kernel::OM = Kernel::System::ObjectManager-&#62;new(
        Kernel::System::Log =&#62; {
            LogPrefix =&#62; &#39;OTRS-MyTestScript&#39;,
        },
    );</pre>

<p>Alternatively, <code>ObjectParamAdd()</code> can be used to set these parameters at runtime (but this must happen before the object was created).</p>

<p>If the <code>Debug =&#62; 1</code> option is present, destruction of objects is checked, and a warning is emitted if objects persist after the attempt to destroy them.</p>

<dt><a name="Get()"
>Get()</a></dt>

<dd>
<p>Retrieves a singleton object, and if it not yet exists, implicitly creates one for you.</p>

<pre>    my $ConfigObject = $Kernel::OM-&#62;Get(&#39;Kernel::Config&#39;);</pre>

<p>DEPRECATED: For backwards compatibility reasons, object aliases can be defined in <a href="../../Kernel/Config/Defaults.html" class="podlinkpod"
>Kernel::Config::Defaults</a>. For example <code>-&#62;Get(&#39;TicketObject&#39;)</code> retrieves a <a href="../../Kernel/System/Ticket.html" class="podlinkpod"
>Kernel::System::Ticket</a> object.</p>

<pre>    my $ConfigObject = $Kernel::OM-&#62;Get(&#39;Kernel::Config&#39;); # returns the same ConfigObject as above</pre>

<dt><a name="ObjectInstanceRegister()"
>ObjectInstanceRegister()</a></dt>

<dd>
<p>Adds an existing object instance to the ObjectManager so that it can be accessed by other objects.</p>

<p>This should only be used on special circumstances, e. g. in the unit tests to pass $Self to the ObjectManager so that it is also available from there as &#39;Kernel::System::UnitTest&#39;.</p>

<pre>    $Kernel::OM-&#62;ObjectInstanceRegister(
        Package      =&#62; &#39;Kernel::System::UnitTest&#39;,
        Object       =&#62; $UnitTestObject,
        Dependencies =&#62; [],         # optional, specify OM-managed packages that the object might depend on
    );</pre>

<dt><a name="ObjectParamAdd()"
>ObjectParamAdd()</a></dt>

<dd>
<p>Adds arguments that will be passed to constructors of classes when they are created, in the same format as the <code>new()</code> method receives them.</p>

<pre>    $Kernel::OM-&#62;ObjectParamAdd(
        &#39;Kernel::System::Ticket&#39; =&#62; {
            Key =&#62; &#39;Value&#39;,
        },
    );</pre>

<p>To remove a key again, send undef as a value:</p>

<pre>    $Kernel::OM-&#62;ObjectParamAdd(
        &#39;Kernel::System::Ticket&#39; =&#62; {
            Key =&#62; undef,               # this will remove the key from the hash
        },
    );</pre>

<dt><a name="ObjectsDiscard()"
>ObjectsDiscard()</a></dt>

<dd>
<p>Discards internally stored objects, so that the next access to objects creates them newly. If a list of object names is passed, only the supplied objects and their recursive dependencies are destroyed. If no list of object names is passed, all stored objects are destroyed.</p>

<pre>    $Kernel::OM-&#62;ObjectsDiscard();

    $Kernel::OM-&#62;ObjectsDiscard(
        Objects            =&#62; [&#39;Kernel::System::Ticket&#39;, &#39;Kernel::System::Queue&#39;],

        # optional
        # forces the packages to be reloaded from the file system
        # sometimes necessary with mod_perl when running CodeUpgrade during a package upgrade
        # if no list of object names is passed, all stored objects are destroyed
        # and forced to be reloaded
        ForcePackageReload =&#62; 1,
    );</pre>

<p>Mostly used for tests that rely on fresh objects, or to avoid large memory consumption in long-running processes.</p>

<p>Note that if you pass a list of objects to be destroyed, they are destroyed in in the order they were passed; otherwise they are destroyed in reverse dependency order.</p>

<dt><a name="ObjectRegisterEventHandler()"
>ObjectRegisterEventHandler()</a></dt>

<dd>
<p>Registers an object that can handle asynchronous events.</p>

<pre>    $Kernel::OM-&#62;ObjectRegisterEventHandler(
        EventHandler =&#62; $EventHandlerObject,
    );</pre>

<p>The <code>EventHandler</code> object should inherit from <a href="../../Kernel/System/EventHandler.html" class="podlinkpod"
>Kernel::System::EventHandler</a>. The object manager will call that object&#39;s <code>EventHandlerHasQueuedTransactions</code> method, and if that returns a true value, calls its <code>EventHandlerTransaction</code> method.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="TERMS_AND_CONDITIONS"
>TERMS AND CONDITIONS</a></h1>

<p>This software is part of the OTRS project (<a href="http://otrs.org/" class="podlinkurl"
>http://otrs.org/</a>).</p>

<p>This software comes with ABSOLUTELY NO WARRANTY. For details, see the enclosed file COPYING for license information (AGPL). If you did not receive this file, see <a href="http://www.gnu.org/licenses/agpl.txt" class="podlinkurl"
>http://www.gnu.org/licenses/agpl.txt</a>.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
