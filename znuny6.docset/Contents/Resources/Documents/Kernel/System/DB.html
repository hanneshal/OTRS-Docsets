<html><head><title>Kernel::System::DB</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.28,
  using Pod::Simple::PullParser v3.28,
  under Perl v5.018004 at Tue Feb 16 20:51:23 2021 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#PUBLIC_INTERFACE'>PUBLIC INTERFACE</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#new()'>new()</a>
    <li class='indexItem indexItem2'><a href='#Connect()'>Connect()</a>
    <li class='indexItem indexItem2'><a href='#Disconnect()'>Disconnect()</a>
    <li class='indexItem indexItem2'><a href='#Version()'>Version()</a>
    <li class='indexItem indexItem2'><a href='#Quote()'>Quote()</a>
    <li class='indexItem indexItem2'><a href='#Error()'>Error()</a>
    <li class='indexItem indexItem2'><a href='#Do()'>Do()</a>
    <li class='indexItem indexItem2'><a href='#Prepare()'>Prepare()</a>
    <li class='indexItem indexItem2'><a href='#FetchrowArray()'>FetchrowArray()</a>
    <li class='indexItem indexItem2'><a href='#ListTables()'>ListTables()</a>
    <li class='indexItem indexItem2'><a href='#GetColumnNames()'>GetColumnNames()</a>
    <li class='indexItem indexItem2'><a href='#SelectAll()'>SelectAll()</a>
    <li class='indexItem indexItem2'><a href='#GetDatabaseFunction()'>GetDatabaseFunction()</a>
    <li class='indexItem indexItem2'><a href='#SQLProcessor()'>SQLProcessor()</a>
    <li class='indexItem indexItem2'><a href='#SQLProcessorPost()'>SQLProcessorPost()</a>
    <li class='indexItem indexItem2'><a href='#QueryCondition()'>QueryCondition()</a>
    <li class='indexItem indexItem2'><a href='#QueryInCondition()'>QueryInCondition()</a>
    <li class='indexItem indexItem2'><a href='#QueryStringEscape()'>QueryStringEscape()</a>
    <li class='indexItem indexItem2'><a href='#Ping()'>Ping()</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#TERMS_AND_CONDITIONS'>TERMS AND CONDITIONS</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
><a name='//apple_ref/cpp/Class/NAME' class='dashAnchor'></a>NAME</a></h1>

<p>Kernel::System::DB - global database interface</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
><a name='//apple_ref/cpp/Class/DESCRIPTION' class='dashAnchor'></a>DESCRIPTION</a></h1>

<p>All database functions to connect/insert/update/delete/...
to a database.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PUBLIC_INTERFACE"
><a name='//apple_ref/cpp/Class/PUBLIC INTERFACE' class='dashAnchor'></a>PUBLIC INTERFACE</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="new()"
><a name='//apple_ref/cpp/Function/new()' class='dashAnchor'></a>new()</a></h2>

<p>create database object,
with database connect..
Usually you do not use it directly,
instead use:</p>

<pre>    use Kernel::System::ObjectManager;
    local $Kernel::OM = Kernel::System::ObjectManager-&#62;new(
        &#39;Kernel::System::DB&#39; =&#62; {
            # if you don&#39;t supply the following parameters, the ones found in
            # Kernel/Config.pm are used instead:
            DatabaseDSN  =&#62; &#39;DBI:odbc:database=123;host=localhost;&#39;,
            DatabaseUser =&#62; &#39;user&#39;,
            DatabasePw   =&#62; &#39;somepass&#39;,
            Type         =&#62; &#39;mysql&#39;,
            Attribute =&#62; {
                LongTruncOk =&#62; 1,
                LongReadLen =&#62; 100*1024,
            },
        },
    );
    my $DBObject = $Kernel::OM-&#62;Get(&#39;Kernel::System::DB&#39;);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Connect()"
><a name='//apple_ref/cpp/Function/Connect()' class='dashAnchor'></a>Connect()</a></h2>

<p>to connect to a database</p>

<pre>    $DBObject-&#62;Connect();</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Disconnect()"
><a name='//apple_ref/cpp/Function/Disconnect()' class='dashAnchor'></a>Disconnect()</a></h2>

<p>to disconnect from a database</p>

<pre>    $DBObject-&#62;Disconnect();</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Version()"
><a name='//apple_ref/cpp/Function/Version()' class='dashAnchor'></a>Version()</a></h2>

<p>to get the database version</p>

<pre>    my $DBVersion = $DBObject-&#62;Version();

    returns: &#34;MySQL 5.1.1&#34;;</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Quote()"
><a name='//apple_ref/cpp/Function/Quote()' class='dashAnchor'></a>Quote()</a></h2>

<p>to quote sql parameters</p>

<pre>    quote strings, date and time:
    =============================
    my $DBString = $DBObject-&#62;Quote( &#34;This isn&#39;t a problem!&#34; );

    my $DBString = $DBObject-&#62;Quote( &#34;2005-10-27 20:15:01&#34; );

    quote integers:
    ===============
    my $DBString = $DBObject-&#62;Quote( 1234, &#39;Integer&#39; );

    quote numbers (e. g. 1, 1.4, 42342.23424):
    ==========================================
    my $DBString = $DBObject-&#62;Quote( 1234, &#39;Number&#39; );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Error()"
><a name='//apple_ref/cpp/Function/Error()' class='dashAnchor'></a>Error()</a></h2>

<p>to retrieve database errors</p>

<pre>    my $ErrorMessage = $DBObject-&#62;Error();</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Do()"
><a name='//apple_ref/cpp/Function/Do()' class='dashAnchor'></a>Do()</a></h2>

<p>to insert, update or delete values</p>

<pre>    $DBObject-&#62;Do( SQL =&#62; &#34;INSERT INTO table (name) VALUES (&#39;dog&#39;)&#34; );

    $DBObject-&#62;Do( SQL =&#62; &#34;DELETE FROM table&#34; );

    you also can use DBI bind values (used for large strings):

    my $Var1 = &#39;dog1&#39;;
    my $Var2 = &#39;dog2&#39;;

    $DBObject-&#62;Do(
        SQL  =&#62; &#34;INSERT INTO table (name1, name2) VALUES (?, ?)&#34;,
        Bind =&#62; [ \$Var1, \$Var2 ],
    );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Prepare()"
><a name='//apple_ref/cpp/Function/Prepare()' class='dashAnchor'></a>Prepare()</a></h2>

<p>to prepare a SELECT statement</p>

<pre>    $DBObject-&#62;Prepare(
        SQL   =&#62; &#34;SELECT id, name FROM table&#34;,
        Limit =&#62; 10,
    );</pre>

<p>or in case you want just to get row 10 until 30</p>

<pre>    $DBObject-&#62;Prepare(
        SQL   =&#62; &#34;SELECT id, name FROM table&#34;,
        Start =&#62; 10,
        Limit =&#62; 20,
    );</pre>

<p>in case you don&#39;t want utf-8 encoding for some columns, use this:</p>

<pre>    $DBObject-&#62;Prepare(
        SQL    =&#62; &#34;SELECT id, name, content FROM table&#34;,
        Encode =&#62; [ 1, 1, 0 ],
    );</pre>

<p>you also can use DBI bind values, required for large strings:</p>

<pre>    my $Var1 = &#39;dog1&#39;;
    my $Var2 = &#39;dog2&#39;;

    $DBObject-&#62;Prepare(
        SQL    =&#62; &#34;SELECT id, name, content FROM table WHERE name_a = ? AND name_b = ?&#34;,
        Encode =&#62; [ 1, 1, 0 ],
        Bind   =&#62; [ \$Var1, \$Var2 ],
    );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="FetchrowArray()"
><a name='//apple_ref/cpp/Function/FetchrowArray()' class='dashAnchor'></a>FetchrowArray()</a></h2>

<p>to process the results of a SELECT statement</p>

<pre>    $DBObject-&#62;Prepare(
        SQL   =&#62; &#34;SELECT id, name FROM table&#34;,
        Limit =&#62; 10
    );

    while (my @Row = $DBObject-&#62;FetchrowArray()) {
        print &#34;$Row[0]:$Row[1]\n&#34;;
    }</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ListTables()"
><a name='//apple_ref/cpp/Function/ListTables()' class='dashAnchor'></a>ListTables()</a></h2>

<p>list all tables in the OTRS database.</p>

<pre>    my @Tables = $DBObject-&#62;ListTables();</pre>

<p>On databases like Oracle it could happen that too many tables are listed (all belonging to the current user), if the user also has permissions for other databases. So this list should only be used for verification of the presence of expected OTRS tables.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetColumnNames()"
><a name='//apple_ref/cpp/Function/GetColumnNames()' class='dashAnchor'></a>GetColumnNames()</a></h2>

<p>to retrieve the column names of a database statement</p>

<pre>    $DBObject-&#62;Prepare(
        SQL   =&#62; &#34;SELECT * FROM table&#34;,
        Limit =&#62; 10
    );

    my @Names = $DBObject-&#62;GetColumnNames();</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="SelectAll()"
><a name='//apple_ref/cpp/Function/SelectAll()' class='dashAnchor'></a>SelectAll()</a></h2>

<p>returns all available records of a SELECT statement. In essence, this calls Prepare() and FetchrowArray() to get all records.</p>

<pre>    my $ResultAsArrayRef = $DBObject-&#62;SelectAll(
        SQL   =&#62; &#34;SELECT id, name FROM table&#34;,
        Limit =&#62; 10
    );</pre>

<p>You can pass the same arguments as to the Prepare() method.</p>

<p>Returns undef (if query failed), or an array ref (if query was successful):</p>

<pre>  my $ResultAsArrayRef = [
    [ 1, &#39;itemOne&#39; ],
    [ 2, &#39;itemTwo&#39; ],
    [ 3, &#39;itemThree&#39; ],
    [ 4, &#39;itemFour&#39; ],
  ];</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="GetDatabaseFunction()"
><a name='//apple_ref/cpp/Function/GetDatabaseFunction()' class='dashAnchor'></a>GetDatabaseFunction()</a></h2>

<p>to get database functions like</p>

<pre>    - Limit
    - DirectBlob
    - QuoteSingle
    - QuoteBack
    - QuoteSemicolon
    - NoLikeInLargeText
    - CurrentTimestamp
    - Encode
    - Comment
    - ShellCommit
    - ShellConnect
    - Connect
    - LikeEscapeString

    my $What = $DBObject-&#62;GetDatabaseFunction(&#39;DirectBlob&#39;);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="SQLProcessor()"
><a name='//apple_ref/cpp/Function/SQLProcessor()' class='dashAnchor'></a>SQLProcessor()</a></h2>

<p>generate database-specific sql syntax (e. g. CREATE TABLE ...)</p>

<pre>    my @SQL = $DBObject-&#62;SQLProcessor(
        Database =&#62;
            [
                Tag  =&#62; &#39;TableCreate&#39;,
                Name =&#62; &#39;table_name&#39;,
            ],
            [
                Tag  =&#62; &#39;Column&#39;,
                Name =&#62; &#39;col_name&#39;,
                Type =&#62; &#39;VARCHAR&#39;,
                Size =&#62; 150,
            ],
            [
                Tag  =&#62; &#39;Column&#39;,
                Name =&#62; &#39;col_name2&#39;,
                Type =&#62; &#39;INTEGER&#39;,
            ],
            [
                Tag =&#62; &#39;TableEnd&#39;,
            ],
    );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="SQLProcessorPost()"
><a name='//apple_ref/cpp/Function/SQLProcessorPost()' class='dashAnchor'></a>SQLProcessorPost()</a></h2>

<p>generate database-specific sql syntax, post data of SQLProcessor(), e. g. foreign keys</p>

<pre>    my @SQL = $DBObject-&#62;SQLProcessorPost();</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="QueryCondition()"
><a name='//apple_ref/cpp/Function/QueryCondition()' class='dashAnchor'></a>QueryCondition()</a></h2>

<p>generate SQL condition query based on a search expression</p>

<pre>    my $SQL = $DBObject-&#62;QueryCondition(
        Key   =&#62; &#39;some_col&#39;,
        Value =&#62; &#39;(ABC+DEF)&#39;,
    );

    add SearchPrefix and SearchSuffix to search, in this case
    for &#34;(ABC*+DEF*)&#34;

    my $SQL = $DBObject-&#62;QueryCondition(
        Key          =&#62; &#39;some_col&#39;,
        Value        =&#62; &#39;(ABC+DEF)&#39;,
        SearchPrefix =&#62; &#39;&#39;,
        SearchSuffix =&#62; &#39;*&#39;
        Extended     =&#62; 1, # use also &#34; &#34; as &#34;&#38;&#38;&#34;, e.g. &#34;bob smith&#34; -&#62; &#34;bob&#38;&#38;smith&#34;
    );

    example of a more complex search condition

    my $SQL = $DBObject-&#62;QueryCondition(
        Key   =&#62; &#39;some_col&#39;,
        Value =&#62; &#39;((ABC&#38;&#38;DEF)&#38;&#38;!GHI)&#39;,
    );

    for a earch condition over more columns

    my $SQL = $DBObject-&#62;QueryCondition(
        Key   =&#62; [ &#39;some_col_a&#39;, &#39;some_col_b&#39; ],
        Value =&#62; &#39;((ABC&#38;&#38;DEF)&#38;&#38;!GHI)&#39;,
    );

    Returns the SQL string or &#34;1=0&#34; if the query could not be parsed correctly.

    my $SQL = $DBObject-&#62;QueryCondition(
        Key      =&#62; [ &#39;some_col_a&#39;, &#39;some_col_b&#39; ],
        Value    =&#62; &#39;((ABC&#38;&#38;DEF)&#38;&#38;!GHI)&#39;,
        BindMode =&#62; 1,
    );

    return the SQL String with ?-values and a array with values references:

    $BindModeResult = (
        &#39;SQL&#39;    =&#62; &#39;WHERE testa LIKE ? AND testb NOT LIKE ? AND testc = ?&#39;
        &#39;Values&#39; =&#62; [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;],
    )</pre>

<p>Note that the comparisons are usually performed case insensitively. Only <code>VARCHAR</code> columns with a size less or equal 3998 are supported, as for locator objects the functioning of SQL function <code>LOWER()</code> can&#39;t be guaranteed.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="QueryInCondition()"
><a name='//apple_ref/cpp/Function/QueryInCondition()' class='dashAnchor'></a>QueryInCondition()</a></h2>

<p>Generate a SQL IN condition query based on the given table key and values.</p>

<pre>    my $SQL = $DBObject-&#62;QueryInCondition(
        Key       =&#62; &#39;table.column&#39;,
        Values    =&#62; [ 1, 2, 3, 4, 5, 6 ],
        QuoteType =&#62; &#39;(undef|Integer|Number)&#39;,
        BindMode  =&#62; (0|1),
        Negate    =&#62; (0|1),
    );</pre>

<p>Returns the SQL string:</p>

<pre>    my $SQL = &#34;ticket_id IN (1, 2, 3, 4, 5, 6)&#34;</pre>

<p>Return a separated IN condition for more then <code>MaxParamCountForInCondition</code> values:</p>

<pre>    my $SQL = &#34;( ticket_id IN ( 1, 2, 3, 4, 5, 6 ... ) OR ticket_id IN ( ... ) )&#34;</pre>

<p>Return the SQL String with ?-values and a array with values references in bind mode:</p>

<pre>    $BindModeResult = (
        &#39;SQL&#39;    =&#62; &#39;ticket_id IN (?, ?, ?, ?, ?, ?)&#39;,
        &#39;Values&#39; =&#62; [1, 2, 3, 4, 5, 6],
    );

    or

    $BindModeResult = (
        &#39;SQL&#39;    =&#62; &#39;( ticket_id IN (?, ?, ?, ?, ?, ?) OR ticket_id IN ( ?, ... ) )&#39;,
        &#39;Values&#39; =&#62; [1, 2, 3, 4, 5, 6, ... ],
    );</pre>

<p>Returns the SQL string for a negated in condition:</p>

<pre>    my $SQL = &#34;ticket_id NOT IN (1, 2, 3, 4, 5, 6)&#34;

    or

    my $SQL = &#34;( ticket_id NOT IN ( 1, 2, 3, 4, 5, 6 ... ) AND ticket_id NOT IN ( ... ) )&#34;</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="QueryStringEscape()"
><a name='//apple_ref/cpp/Function/QueryStringEscape()' class='dashAnchor'></a>QueryStringEscape()</a></h2>

<p>escapes special characters within a query string</p>

<pre>    my $QueryStringEscaped = $DBObject-&#62;QueryStringEscape(
        QueryString =&#62; &#39;customer with (brackets) and &#38; and -&#39;,
    );

    Result would be a string in which all special characters are escaped.
    Special characters are those which are returned by _SpecialCharactersGet().

    $QueryStringEscaped = &#39;customer with \(brackets\) and \&#38; and \-&#39;;</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Ping()"
><a name='//apple_ref/cpp/Function/Ping()' class='dashAnchor'></a>Ping()</a></h2>

<p>checks if the database is reachable</p>

<pre>    my $Success = $DBObject-&#62;Ping(
        AutoConnect =&#62; 0,  # default 1
    );</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="TERMS_AND_CONDITIONS"
><a name='//apple_ref/cpp/Class/TERMS AND CONDITIONS' class='dashAnchor'></a>TERMS AND CONDITIONS</a></h1>

<p>This software is part of the OTRS project (<a href="https://otrs.org/" class="podlinkurl"
>https://otrs.org/</a>).</p>

<p>This software comes with ABSOLUTELY NO WARRANTY. For details, see the enclosed file COPYING for license information (GPL). If you did not receive this file, see <a href="https://www.gnu.org/licenses/gpl-3.0.txt" class="podlinkurl"
>https://www.gnu.org/licenses/gpl-3.0.txt</a>.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
