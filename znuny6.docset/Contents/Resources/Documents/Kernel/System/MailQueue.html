<html><head><title>Kernel::System::MailQueue</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.28,
  using Pod::Simple::PullParser v3.28,
  under Perl v5.018004 at Tue Feb 16 20:51:23 2021 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#PUBLIC_INTERFACE'>PUBLIC INTERFACE</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#new()'>new()</a>
    <li class='indexItem indexItem2'><a href='#Create()'>Create()</a>
    <li class='indexItem indexItem2'><a href='#List()'>List()</a>
    <li class='indexItem indexItem2'><a href='#Get()'>Get()</a>
    <li class='indexItem indexItem2'><a href='#Update()'>Update()</a>
    <li class='indexItem indexItem2'><a href='#Delete()'>Delete()</a>
    <li class='indexItem indexItem2'><a href='#Send()'>Send()</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#PRIVATE_INTERFACE'>PRIVATE INTERFACE</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#_SendSuccess()'>_SendSuccess()</a>
    <li class='indexItem indexItem2'><a href='#_SendError()'>_SendError()</a>
    <li class='indexItem indexItem2'><a href='#_SetArticleTransmissionError()'>_SetArticleTransmissionError()</a>
    <li class='indexItem indexItem2'><a href='#_SendEventNotification()'>_SendEventNotification()</a>
    <li class='indexItem indexItem2'><a href='#_FiltersSQLAndBinds()'>_FiltersSQLAndBinds()</a>
    <li class='indexItem indexItem2'><a href='#_CheckValidEmailAddresses()'>_CheckValidEmailAddresses()</a>
    <li class='indexItem indexItem2'><a href='#_CheckValidMessageData()'>_CheckValidMessageData()</a>
    <li class='indexItem indexItem2'><a href='#_SerializeMessage()'>_SerializeMessage()</a>
    <li class='indexItem indexItem2'><a href='#_DeserializeMessage()'>_DeserializeMessage()</a>
    <li class='indexItem indexItem2'><a href='#_IsArticleAlreadyQueued()'>_IsArticleAlreadyQueued()</a>
    <li class='indexItem indexItem2'><a href='#_DBInsert()'>_DBInsert()</a>
    <li class='indexItem indexItem2'><a href='#_CreateCommunicationLogLookup()'>_CreateCommunicationLogLookup()</a>
    <li class='indexItem indexItem2'><a href='#_GetCommunicationLog()'>_GetCommunicationLog()</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#TERMS_AND_CONDITIONS'>TERMS AND CONDITIONS</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PUBLIC_INTERFACE"
><a name='//apple_ref/cpp/Class/PUBLIC INTERFACE' class='dashAnchor'></a>PUBLIC INTERFACE</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="new()"
><a name='//apple_ref/cpp/Function/new()' class='dashAnchor'></a>new()</a></h2>

<p>Create a MailQueue object.
Do not use it directly,
instead use:</p>

<pre>    my $MailQueueObject = $Kernel::OM-&#62;Get(&#39;Kernel::System::MailQueue&#39;);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Create()"
><a name='//apple_ref/cpp/Function/Create()' class='dashAnchor'></a>Create()</a></h2>

<p>Create a new queue element.</p>

<pre>    my $Result = $MailQueue-&#62;Create(
        ArticleID       =&#62; &#39;...&#39;, # optional
        MessageID       =&#62; &#39;...&#39;, # optional (in case article id was passed this should be also)
        Sender          =&#62; &#39;...&#39;,
        Recipient       =&#62; &#39;...&#39; || [],
        Message         =&#62; &#39;...&#39;,
        Attempts        =&#62; &#39;...&#39;, # optional
    );</pre>

<p>Returns 1 or undef.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="List()"
><a name='//apple_ref/cpp/Function/List()' class='dashAnchor'></a>List()</a></h2>

<p>Get a list of the queue elements.</p>

<pre>    my $List = $MailQueue-&#62;List(
        ID              =&#62; &#39;...&#39; # optional
        ArticleID       =&#62; &#39;...&#39; # optional
        Sender          =&#62; &#39;...&#39; # optional
        Recipient       =&#62; &#39;...&#39; # optional
        Attempts        =&#62; &#39;...&#39; # optional
    );</pre>

<p>This returns something like:</p>

<pre>    my $List = [
        {
            ID                        =&#62; &#39;...&#39;,
            ArticleID                 =&#62; &#39;...&#39;,
            Attempts                  =&#62; &#39;...&#39;,
            Sender                    =&#62; &#39;...&#39;,
            Recipient                 =&#62; [&#39;...&#39;],
            Message                   =&#62; &#39;...&#39;,
            DueTime                   =&#62; &#39;...&#39;,
            LastSMTPCode              =&#62; &#39;...&#39;,
            LastSMTPMessage           =&#62; &#39;...&#39;,
        },
        ...,
    ]</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Get()"
><a name='//apple_ref/cpp/Function/Get()' class='dashAnchor'></a>Get()</a></h2>

<p>Get a queue element.</p>

<pre>    my $Item = $MailQueue-&#62;Get(
        ID              =&#62; &#39;...&#39; # optional
        ArticleID       =&#62; &#39;...&#39; # optional
    );</pre>

<p>This returns something like:</p>

<pre>    $Item = {
        ID                        =&#62; &#39;...&#39;,
        ArticleID                 =&#62; &#39;...&#39;,
        Attempts                  =&#62; &#39;...&#39;,
        Sender                    =&#62; &#39;...&#39;,
        Recipient                 =&#62; [&#39;...&#39;],
        Message                   =&#62; &#39;...&#39;,
        DueTime                   =&#62; &#39;...&#39;,
        LastSMTPCode              =&#62; &#39;...&#39;,
        LastSMTPMessage           =&#62; &#39;...&#39;,
    };</pre>

<p>or and empty hashref if element not found.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Update()"
><a name='//apple_ref/cpp/Function/Update()' class='dashAnchor'></a>Update()</a></h2>

<p>Update queue elements.</p>

<pre>    my $Result = $MailQueue-&#62;Update(
        Filters =&#62; {},
        Data    =&#62; {},
    );</pre>

<p>Returns 1 or undef.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Delete()"
><a name='//apple_ref/cpp/Function/Delete()' class='dashAnchor'></a>Delete()</a></h2>

<p>Delete queue elements.</p>

<pre>    my $Result = $MailQueue-&#62;Delete(
        %Filters,                       # See _FiltersSQLAndBinds
    );</pre>

<p>Returns 1 or undef.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Send()"
><a name='//apple_ref/cpp/Function/Send()' class='dashAnchor'></a>Send()</a></h2>

<p>Send/Process a mail queue element/item.</p>

<pre>    my $List = $MailQueue-&#62;Send(
        ID              =&#62; &#39;...&#39;,
        Sender          =&#62; &#39;...&#39;,
        Recipient       =&#62; &#39;...&#39;,
        Message         =&#62; &#39;...&#39;,
        Force           =&#62; &#39;...&#39; # optional, to force the sending even if isn&#39;t time
    );</pre>

<p>This returns something like:</p>

<pre>    $List = {
        Status  =&#62; &#39;(Failed|Pending|Success)&#39;,
        Message =&#62; &#39;...&#39;,                      # undef if success.
    };</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PRIVATE_INTERFACE"
><a name='//apple_ref/cpp/Class/PRIVATE INTERFACE' class='dashAnchor'></a>PRIVATE INTERFACE</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_SendSuccess()"
><a name='//apple_ref/cpp/Function/_SendSuccess()' class='dashAnchor'></a>_SendSuccess()</a></h2>

<p>This method is called after a MailQueue item is successfully sent. It clears the item from the MailQueue, closes the communication log and triggers a Event Notification.</p>

<pre>    my $Result = $Object-&#62;_SendSuccess(
        Item =&#62; {
            ID                        =&#62; ...,
            ArticleID                 =&#62; ..., # optional
            UserID                    =&#62; ...,
            CommunicationLogObject    =&#62; ...,
        }
    );</pre>

<p>Returns 1 or undef.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_SendError()"
><a name='//apple_ref/cpp/Function/_SendError()' class='dashAnchor'></a>_SendError()</a></h2>

<p>Handles Send errors. Situations where the mail queue item is deleted: - SMTP 5?? errors codes, considered permanent errors. - reached maximum attempts</p>

<pre>    $Object-&#62;_SendError(
        Item       =&#62; ...,
        SendResult =&#62; ...,
    );</pre>

<p>This always returns undef.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_SetArticleTransmissionError()"
><a name='//apple_ref/cpp/Function/_SetArticleTransmissionError()' class='dashAnchor'></a>_SetArticleTransmissionError()</a></h2>

<p>Creates or Updates the Article Transmission Error record with the error message. Then, fires a Notification Event.</p>

<pre>    my $Result = $Object-&#62;_SetArticleTransmissionError(
        ArticleID                 =&#62; ...,
        Message                   =&#62; ...,
        MessageID                 =&#62; ...,
        UserID                    =&#62; ...,
        ForceUpdate               =&#62; ...,
        CommunicationLogObject    =&#62; ...,
    );</pre>

<p>Returns 1 or undef.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_SendEventNotification()"
><a name='//apple_ref/cpp/Function/_SendEventNotification()' class='dashAnchor'></a>_SendEventNotification()</a></h2>

<p>Formats a Notification and asks Event Handler to send it.</p>

<pre>    my $Result = $Object-&#62;_SendEventNotification(
        ArticleID =&#62; ...,
        Status    =&#62; &#34;Queued|Sent|Error&#34;,
        Message   =&#62; ...,
        UserID    =&#62; ...,
    );</pre>

<p>This returns something like:</p>

<pre>    my $Result = {
        Status  =&#62; &#39;Failed&#39;,
        Message =&#62; &#39;Need ArticleID&#39;
    };</pre>

<p>in case of missing or invalid arguments, or the status of the EventHandler call.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_FiltersSQLAndBinds()"
><a name='//apple_ref/cpp/Function/_FiltersSQLAndBinds()' class='dashAnchor'></a>_FiltersSQLAndBinds()</a></h2>

<p>Build the filter sql and associated binds.</p>

<pre>    my ( $FilterSQL, $Binds ) = $MailQueue-&#62;_FiltersSQLAndBinds(
        ID              =&#62; &#39;...&#39; # optional
        ArticleID       =&#62; &#39;...&#39; # optional
        CommunicationID =&#62; &#39;...&#39; # optional
        Sender          =&#62; &#39;...&#39; # optional
        Recipient       =&#62; &#39;...&#39; # optional
        Attempts        =&#62; &#39;...&#39; # optional
    );</pre>

<p>This returns something like:</p>

<pre>    $FilterSQL = &#39;...&#39;;
    $Binds     = \[...];</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_CheckValidEmailAddresses()"
><a name='//apple_ref/cpp/Function/_CheckValidEmailAddresses()' class='dashAnchor'></a>_CheckValidEmailAddresses()</a></h2>

<p>Check if the provided email address(es) is valid.</p>

<pre>    my $IsValid = $MailQueue-&#62;_CheckValidEmailAddresses(
        ParamName =&#62; &#39;...&#39;       # name of the parameter that we are checking
        Addresses =&#62; &#39;...&#39; || [] # email addresses to validate
    );</pre>

<p>Returns 1 or undef.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_CheckValidMessageData()"
><a name='//apple_ref/cpp/Function/_CheckValidMessageData()' class='dashAnchor'></a>_CheckValidMessageData()</a></h2>

<p>Check if the provided data is a non-empty hash-ref.</p>

<pre>    my $IsValid = $MailQueue-&#62;_CheckValidMessageData(
        Data =&#62; {...}
    );</pre>

<p>Returns 1 or undef.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_SerializeMessage()"
><a name='//apple_ref/cpp/Function/_SerializeMessage()' class='dashAnchor'></a>_SerializeMessage()</a></h2>

<p>Serialize a simple perl structure to be save in the database.</p>

<p>Returns an encoded or a storable string.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_DeserializeMessage()"
><a name='//apple_ref/cpp/Function/_DeserializeMessage()' class='dashAnchor'></a>_DeserializeMessage()</a></h2>

<p>Deserialize a simple perl structure to the original format.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_IsArticleAlreadyQueued()"
><a name='//apple_ref/cpp/Function/_IsArticleAlreadyQueued()' class='dashAnchor'></a>_IsArticleAlreadyQueued()</a></h2>

<p>Checks if the article is already queued.</p>

<p>Returns 1 or undef.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_DBInsert()"
><a name='//apple_ref/cpp/Function/_DBInsert()' class='dashAnchor'></a>_DBInsert()</a></h2>

<p>Inserts a new record in the table and returns the newly record id. Returns a number (id of the new record inserted) or undef.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_CreateCommunicationLogLookup()"
><a name='//apple_ref/cpp/Function/_CreateCommunicationLogLookup()' class='dashAnchor'></a>_CreateCommunicationLogLookup()</a></h2>

<p>Creates the mail-queue item communication-log message association. It will also create the association for the article if any ArticleID was passed. Returns 1 always.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_GetCommunicationLog()"
><a name='//apple_ref/cpp/Function/_GetCommunicationLog()' class='dashAnchor'></a>_GetCommunicationLog()</a></h2>

<p>Get the communication log associated to the queue item, if not found, creates a new one.</p>

<pre>    my $CommunicationLog = $Self-&#62;_GetCommunicationLog(
        ID =&#62; &#39;...&#39; # mail-queue item ID
    );</pre>

<p>Returns communication-log object.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="TERMS_AND_CONDITIONS"
><a name='//apple_ref/cpp/Class/TERMS AND CONDITIONS' class='dashAnchor'></a>TERMS AND CONDITIONS</a></h1>

<p>This software is part of the OTRS project (<a href="https://otrs.org/" class="podlinkurl"
>https://otrs.org/</a>).</p>

<p>This software comes with ABSOLUTELY NO WARRANTY. For details, see the enclosed file COPYING for license information (GPL). If you did not receive this file, see <a href="https://www.gnu.org/licenses/gpl-3.0.txt" class="podlinkurl"
>https://www.gnu.org/licenses/gpl-3.0.txt</a>.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
