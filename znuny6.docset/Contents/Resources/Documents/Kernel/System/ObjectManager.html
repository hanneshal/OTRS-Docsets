<html><head><title>Kernel::System::ObjectManager</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.28,
  using Pod::Simple::PullParser v3.28,
  under Perl v5.018004 at Tue Feb 16 20:51:23 2021 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#How_does_singleton_management_work%3F'>How does singleton management work?</a>
    <li class='indexItem indexItem2'><a href='#How_to_use_it%3F'>How to use it?</a>
    <li class='indexItem indexItem2'><a href='#Which_objects_can_be_loaded%3F'>Which objects can be loaded?</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#PUBLIC_INTERFACE'>PUBLIC INTERFACE</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#new()'>new()</a>
    <li class='indexItem indexItem2'><a href='#Get()'>Get()</a>
    <li class='indexItem indexItem2'><a href='#Create()'>Create()</a>
    <li class='indexItem indexItem2'><a href='#ObjectInstanceRegister()'>ObjectInstanceRegister()</a>
    <li class='indexItem indexItem2'><a href='#ObjectParamAdd()'>ObjectParamAdd()</a>
    <li class='indexItem indexItem2'><a href='#ObjectEventsHandle()'>ObjectEventsHandle()</a>
    <li class='indexItem indexItem2'><a href='#ObjectsDiscard()'>ObjectsDiscard()</a>
    <li class='indexItem indexItem2'><a href='#ObjectRegisterEventHandler()'>ObjectRegisterEventHandler()</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#TERMS_AND_CONDITIONS'>TERMS AND CONDITIONS</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
><a name='//apple_ref/cpp/Class/NAME' class='dashAnchor'></a>NAME</a></h1>

<p>Kernel::System::ObjectManager - Central singleton manager and object instance generator</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
><a name='//apple_ref/cpp/Class/SYNOPSIS' class='dashAnchor'></a>SYNOPSIS</a></h1>

<pre>    # In top level scripts only!
    local $Kernel::OM = Kernel::System::ObjectManager-&#62;new();

    # Everywhere: get a singleton instance (and create it, if needed).
    my $ConfigObject = $Kernel::OM-&#62;Get(&#39;Kernel::Config&#39;);

    # Remove singleton objects and all their dependencies.
    $Kernel::OM-&#62;ObjectsDiscard(
        Objects            =&#62; [&#39;Kernel::System::Ticket&#39;, &#39;Kernel::System::Queue&#39;],
    );</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
><a name='//apple_ref/cpp/Class/DESCRIPTION' class='dashAnchor'></a>DESCRIPTION</a></h1>

<p>The ObjectManager is the central place to create and access singleton OTRS objects (via <code><a href="#Get()" class="podlinkpod"
>&#34;Get()&#34;</a></code>) as well as create regular (unmanaged) object instances (via <code><a href="#Create()" class="podlinkpod"
>&#34;Create()&#34;</a></code>).</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="How_does_singleton_management_work?"
><a name='//apple_ref/cpp/Function/How does singleton management work?' class='dashAnchor'></a>How does singleton management work?</a></h2>

<p>It creates objects as late as possible and keeps references to them. Upon destruction the objects are destroyed in the correct order, based on their dependencies (see below).</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="How_to_use_it?"
><a name='//apple_ref/cpp/Function/How to use it?' class='dashAnchor'></a>How to use it?</a></h2>

<p>The ObjectManager must always be provided to OTRS by the top level script like this:</p>

<pre>    use Kernel::System::ObjectManager;
    local $Kernel::OM = Kernel::System::ObjectManager-&#62;new(
        # possible options for module constructors here
        LogObject {
            LogPrefix =&#62; &#39;OTRS-MyTestScript&#39;,
        },
    );</pre>

<p>Then in the code any singleton object can be retrieved that the ObjectManager can handle, like Kernel::System::DB:</p>

<pre>    return if !$Kernel::OM-&#62;Get(&#39;Kernel::System::DB&#39;)-&#62;Prepare(&#39;SELECT 1&#39;);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Which_objects_can_be_loaded?"
><a name='//apple_ref/cpp/Function/Which objects can be loaded?' class='dashAnchor'></a>Which objects can be loaded?</a></h2>

<p>The ObjectManager can load every object that declares its dependencies like this in the Perl package:</p>

<pre>    package Kernel::System::Valid;

    use strict;
    use warnings;

    our @ObjectDependencies = (
        &#39;Kernel::System::Cache&#39;,
        &#39;Kernel::System::DB&#39;,
        &#39;Kernel::System::Log&#39;,
    );</pre>

<p>The <code>@ObjectDependencies</code> is the list of objects that the current object will depend on. They will be destroyed only after this object is destroyed (only for singletons).</p>

<p>If you want to signal that a package can NOT be loaded by the ObjectManager, you can use the <code>$ObjectManagerDisabled</code> flag:</p>

<pre>    package Kernel::System::MyBaseClass;

    use strict;
    use warnings;

    our $ObjectManagerDisabled = 1;</pre>

<p>There are a few flags available to convey meta data about the packages to the object manager.</p>

<p>To indicate that a certain package can <b>only</b> be loaded as a singleton, you can use the <code>IsSingleton</code> flag. Similarly, you can indicate that a certain package can <b>only</b> be created as unmanaged instance, and <b>not</b> as a singleton via the <code>NonSingleton</code> flag. By default, the ObjectManager will die if a constructor does not return an object. To suppress this in the <code><a href="#Create()" class="podlinkpod"
>&#34;Create()&#34;</a></code> method, you can use the <code>AllowConstructorFailure</code> flag (this will not work with <code><a href="#Get()" class="podlinkpod"
>&#34;Get()&#34;</a></code>).</p>

<pre>    package Kernel::System::MyPackage;

    use strict;
    use warnings;

    our %ObjectManagerFlags = (
        IsSingleton             =&#62; 1,  # default 0
        NonSingleton            =&#62; 0,  # default 0
        AllowConstructorFailure =&#62; 0,  # default 0
    );</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PUBLIC_INTERFACE"
><a name='//apple_ref/cpp/Class/PUBLIC INTERFACE' class='dashAnchor'></a>PUBLIC INTERFACE</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="new()"
><a name='//apple_ref/cpp/Function/new()' class='dashAnchor'></a>new()</a></h2>

<p>Creates a new instance of Kernel::System::ObjectManager.</p>

<p>This is typically <b>only</b> needed in top level (<code>bin/</code>) scripts! All parts of the OTRS API assume the ObjectManager to be present in <code>$Kernel::OM</code> and use it.</p>

<p>Sometimes objects need parameters to be sent to their constructors, these can also be passed to the ObjectManager&#39;s constructor like in the following example. The hash reference will be flattened and passed to the constructor of the object(s).</p>

<pre>    local $Kernel::OM = Kernel::System::ObjectManager-&#62;new(
        Kernel::System::Log =&#62; {
            LogPrefix =&#62; &#39;OTRS-MyTestScript&#39;,
        },
    );</pre>

<p>Alternatively, <code><a href="#ObjectParamAdd()" class="podlinkpod"
>&#34;ObjectParamAdd()&#34;</a></code> can be used to set these parameters at runtime (but this must happen before the object was created).</p>

<p>If the <code>Debug =&#62; 1</code> option is present, destruction of objects is checked, and a warning is emitted if objects persist after the attempt to destroy them.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Get()"
><a name='//apple_ref/cpp/Function/Get()' class='dashAnchor'></a>Get()</a></h2>

<p>Retrieves a singleton object, and if it not yet exists, implicitly creates one for you.</p>

<pre>    my $ConfigObject = $Kernel::OM-&#62;Get(&#39;Kernel::Config&#39;);

    # On the second call, this returns the same ConfigObject as above.
    my $ConfigObject2 = $Kernel::OM-&#62;Get(&#39;Kernel::Config&#39;);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Create()"
><a name='//apple_ref/cpp/Function/Create()' class='dashAnchor'></a>Create()</a></h2>

<p>Creates a new object instance. This instance will not be managed by the object manager later on.</p>

<pre>    my $DateTimeObject = $Kernel::OM-&#62;Create(&#39;Kernel::System::DateTime&#39;);

    # On the second call, this creates a new independent instance.
    my $DateTimeObject2 = $Kernel::OM-&#62;Create(&#39;Kernel::System::DateTime&#39;);</pre>

<p>It is also possible to pass in constructor parameters:</p>

<pre>    my $DateTimeObject = $Kernel::OM-&#62;Create(
        &#39;Kernel::System::DateTime&#39;,
        ObjectParams =&#62; {
            Param1 =&#62; &#39;Value1&#39;,
        },
    );</pre>

<p>By default, this method will <code>die</code>, if the package cannot be instantiated or the constructor returns undef. You can suppress this with <code>Silent =&#62; 1</code>, for example to not cause exceptions when trying to load modules based on user configuration.</p>

<pre>    my $CustomObject = $Kernel::OM-&#62;Create(
        &#39;Kernel::System::CustomObject&#39;,
        Silent =&#62; 1,
    );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ObjectInstanceRegister()"
><a name='//apple_ref/cpp/Function/ObjectInstanceRegister()' class='dashAnchor'></a>ObjectInstanceRegister()</a></h2>

<p>Adds an existing object instance to the ObjectManager so that it can be accessed by other objects.</p>

<p>This should <b>only</b> be used on special circumstances, e. g. in the unit tests to pass <code>$Self</code> to the ObjectManager so that it is also available from there as &#39;Kernel::System::UnitTest&#39;.</p>

<pre>    $Kernel::OM-&#62;ObjectInstanceRegister(
        Package      =&#62; &#39;Kernel::System::UnitTest&#39;,
        Object       =&#62; $UnitTestObject,
        Dependencies =&#62; [],         # optional, specify OM-managed packages that the object might depend on
    );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ObjectParamAdd()"
><a name='//apple_ref/cpp/Function/ObjectParamAdd()' class='dashAnchor'></a>ObjectParamAdd()</a></h2>

<p>Adds arguments that will be passed to constructors of classes when they are created, in the same format as the <code><a href="../../new().html" class="podlinkpod"
>new()</a></code> method receives them.</p>

<pre>    $Kernel::OM-&#62;ObjectParamAdd(
        &#39;Kernel::System::Ticket&#39; =&#62; {
            Key =&#62; &#39;Value&#39;,
        },
    );</pre>

<p>To remove a key again, send undef as a value:</p>

<pre>    $Kernel::OM-&#62;ObjectParamAdd(
        &#39;Kernel::System::Ticket&#39; =&#62; {
            Key =&#62; undef,               # this will remove the key from the hash
        },
    );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ObjectEventsHandle()"
><a name='//apple_ref/cpp/Function/ObjectEventsHandle()' class='dashAnchor'></a>ObjectEventsHandle()</a></h2>

<p>Execute all queued (<code>Transaction =&#62; 1</code>) events for all singleton objects that the ObjectManager created before. This can be used to flush the event queue before destruction, for example.</p>

<pre>    $Kernel::OM-&#62;ObjectEventsHandle();</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ObjectsDiscard()"
><a name='//apple_ref/cpp/Function/ObjectsDiscard()' class='dashAnchor'></a>ObjectsDiscard()</a></h2>

<p>Discards internally stored objects, so that the next access to objects creates them newly. If a list of object names is passed, only the supplied objects and their recursive dependencies are destroyed. If no list of object names is passed, all stored objects are destroyed.</p>

<pre>    $Kernel::OM-&#62;ObjectsDiscard();

    $Kernel::OM-&#62;ObjectsDiscard(
        Objects            =&#62; [&#39;Kernel::System::Ticket&#39;, &#39;Kernel::System::Queue&#39;],

        # optional
        # forces the packages to be reloaded from the file system
        # sometimes necessary with mod_perl when running CodeUpgrade during a package upgrade
        # if no list of object names is passed, all stored objects are destroyed
        # and forced to be reloaded
        ForcePackageReload =&#62; 1,
    );</pre>

<p>Mostly used for tests that rely on fresh objects, or to avoid large memory consumption in long-running processes.</p>

<p>Note that if you pass a list of objects to be destroyed, they are destroyed in in the order they were passed; otherwise they are destroyed in reverse dependency order.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ObjectRegisterEventHandler()"
><a name='//apple_ref/cpp/Function/ObjectRegisterEventHandler()' class='dashAnchor'></a>ObjectRegisterEventHandler()</a></h2>

<p>Registers an object that can handle asynchronous events.</p>

<pre>    $Kernel::OM-&#62;ObjectRegisterEventHandler(
        EventHandler =&#62; $EventHandlerObject,
    );</pre>

<p>The <code>EventHandler</code> object should inherit from <a href="../../Kernel/System/EventHandler.html" class="podlinkpod"
>Kernel::System::EventHandler</a>. The object manager will call that object&#39;s <code>EventHandlerHasQueuedTransactions</code> method, and if that returns a true value, calls its <code>EventHandlerTransaction</code> method.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="TERMS_AND_CONDITIONS"
><a name='//apple_ref/cpp/Class/TERMS AND CONDITIONS' class='dashAnchor'></a>TERMS AND CONDITIONS</a></h1>

<p>This software is part of the OTRS project (<a href="https://otrs.org/" class="podlinkurl"
>https://otrs.org/</a>).</p>

<p>This software comes with ABSOLUTELY NO WARRANTY. For details, see the enclosed file COPYING for license information (GPL). If you did not receive this file, see <a href="https://www.gnu.org/licenses/gpl-3.0.txt" class="podlinkurl"
>https://www.gnu.org/licenses/gpl-3.0.txt</a>.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
