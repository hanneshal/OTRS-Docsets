<html><head><title>Kernel::System::Cache</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.28,
  using Pod::Simple::PullParser v3.28,
  under Perl v5.018004 at Tue Feb 16 20:51:23 2021 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#CACHING_STRATEGY'>CACHING STRATEGY</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#CACHE_TYPES'>CACHE TYPES</a>
    <li class='indexItem indexItem2'><a href='#CACHE_KEYS'>CACHE KEYS</a>
    <li class='indexItem indexItem2'><a href='#CACHING_A_BACKEND_MODULE'>CACHING A BACKEND MODULE</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#PUBLIC_INTERFACE'>PUBLIC INTERFACE</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#new()'>new()</a>
    <li class='indexItem indexItem2'><a href='#Configure()'>Configure()</a>
    <li class='indexItem indexItem2'><a href='#Set()'>Set()</a>
    <li class='indexItem indexItem2'><a href='#Get()'>Get()</a>
    <li class='indexItem indexItem2'><a href='#Delete()'>Delete()</a>
    <li class='indexItem indexItem2'><a href='#CleanUp()'>CleanUp()</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#TERMS_AND_CONDITIONS'>TERMS AND CONDITIONS</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
><a name='//apple_ref/cpp/Class/NAME' class='dashAnchor'></a>NAME</a></h1>

<p>Kernel::System::Cache - Key/value based data cache for OTRS</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
><a name='//apple_ref/cpp/Class/DESCRIPTION' class='dashAnchor'></a>DESCRIPTION</a></h1>

<p>This is a simple data cache.
It can store key/value data both in memory and in a configured cache backend for persistent caching.</p>

<p>This can be controlled via the config settings <code>Cache::InMemory</code> and <code>Cache::InBackend</code>.
The backend can also be selected with the config setting <code>Cache::Module</code> and defaults to file system based storage for permanent caching.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CACHING_STRATEGY"
><a name='//apple_ref/cpp/Class/CACHING STRATEGY' class='dashAnchor'></a>CACHING STRATEGY</a></h1>

<p>Caching works based on <code>CacheType</code>s and <code>CacheKey</code>s.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="CACHE_TYPES"
><a name='//apple_ref/cpp/Function/CACHE TYPES' class='dashAnchor'></a>CACHE TYPES</a></h2>

<p>For file based caching,
a <code>CacheType</code> groups all contained entries in a top level directory like <code>var/tmp/CacheFileStorable/MyCacheType</code>.
This means also that all entries of a specific <code>CacheType</code> can be deleted with one function call,
<a href="#CleanUp()" class="podlinkpod"
>&#34;CleanUp()&#34;</a>.</p>

<p>Typically,
every backend module like <a href="../../Kernel/System/Valid.html" class="podlinkpod"
>Kernel::System::Valid</a> has its own CacheType that is stored in <code>$Self</code> for consistent use.
There could be exceptions when modules have much cached data that needs to be cleaned up together.
In this case additional <code>CacheType</code>s could be used,
but this should be avoided.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="CACHE_KEYS"
><a name='//apple_ref/cpp/Function/CACHE KEYS' class='dashAnchor'></a>CACHE KEYS</a></h2>

<p>A <code>CacheKey</code> is used to identify a single cached entry within a <code>CacheType</code>.
The specified cache key will be internally hashed to a file name that is used to fetch/store that particular cache entry,
like <code>var/tmp/CacheFileStorable/Valid/2/1/217727036cc9b1804f7c0f4f7777ef86</code>.</p>

<p>It is important that all variables that lead to the output of different results of a function must be part of the <code>CacheKey</code> if the entire function result is to be stored in a separate cache entry.
For example,
<a href="../../Kernel/System/State.html#StateGet()" class="podlinkpod"
>&#34;StateGet()&#34; in Kernel::System::State</a> allows fetching of <code>State</code>s by <code>Name</code> or by <code>ID</code>.
So there are different cache keys for both cases:</p>

<pre>    my $CacheKey;
    if ( $Param{Name} ) {
        $CacheKey = &#39;StateGet::Name::&#39; . $Param{Name};
    }
    else {
        $CacheKey = &#39;StateGet::ID::&#39; . $Param{ID};
    }</pre>

<p>Please avoid the creation of too many different cache keys, as this can be a burden for storage and performance of the system. Sometimes it can be helpful to implement a function like the one presented above in another way: <code>StateGet()</code> could call the cached <code>StateList()</code> internally and fetch the requested entry from its result. This depends on the amount of data, of course.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="CACHING_A_BACKEND_MODULE"
><a name='//apple_ref/cpp/Function/CACHING A BACKEND MODULE' class='dashAnchor'></a>CACHING A BACKEND MODULE</a></h2>

<dl>
<dt><a name="Define_a_CacheType_and_a_CacheTTL."
>Define a <code>CacheType</code> and a <code>CacheTTL</code>.</a></dt>

<dd>
<p>Every module should have its own <code>CacheType</code> which typically resembles the module name. The <code>CacheTTL</code> defines how long a cache is valid. This depends on the data, but a value of 30 days is considered a good default choice.</p>

<dt><a name="Add_caching_to_methods_fetching_data."
>Add caching to methods fetching data.</a></dt>

<dd>
<p>All functions that list and fetch entities can potentially get caches.</p>

<dt><a name="Implement_cache_cleanup."
>Implement cache cleanup.</a></dt>

<dd>
<p>All functions that add, modify or delete entries need to make sure that the cache stays consistent. All of these operations typically need to cleanup list method caches, while only modify and delete affect individual cache entries that need to be deleted.</p>

<p>Whenever possible, avoid calling <a href="#CleanUp()" class="podlinkpod"
>&#34;CleanUp()&#34;</a> for an entire cache type, but instead delete individual cache entries with <a href="#Delete()" class="podlinkpod"
>&#34;Delete()&#34;</a> to keep as much cached data as possible.</p>

<p>It is recommendable to implement a <code>_CacheCleanup()</code> method in the module that centralizes cache cleanup.</p>

<dt><a name="Extend_module_tests."
>Extend module tests.</a></dt>

<dd>
<p>Please also extend the module tests to work on non-cached and cached values (e. g. calling a method more than one time) to ensure consistency of both cached and non-cached data, and proper cleanup on deleting entities.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PUBLIC_INTERFACE"
><a name='//apple_ref/cpp/Class/PUBLIC INTERFACE' class='dashAnchor'></a>PUBLIC INTERFACE</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="new()"
><a name='//apple_ref/cpp/Function/new()' class='dashAnchor'></a>new()</a></h2>

<p>Don&#39;t use the constructor directly, use the ObjectManager instead:</p>

<pre>    my $CacheObject = $Kernel::OM-&#62;Get(&#39;Kernel::System::Cache&#39;);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Configure()"
><a name='//apple_ref/cpp/Function/Configure()' class='dashAnchor'></a>Configure()</a></h2>

<p>change cache configuration settings at runtime. You can use this to disable the cache in environments where it is not desired, such as in long running scripts.</p>

<p>please, to turn CacheInMemory off in persistent environments.</p>

<pre>    $CacheObject-&#62;Configure(
        CacheInMemory  =&#62; 1,    # optional
        CacheInBackend =&#62; 1,    # optional
    );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Set()"
><a name='//apple_ref/cpp/Function/Set()' class='dashAnchor'></a>Set()</a></h2>

<p>store a value in the cache.</p>

<pre>    $CacheObject-&#62;Set(
        Type  =&#62; &#39;ObjectName&#39;,      # only [a-zA-Z0-9_] chars usable
        Key   =&#62; &#39;SomeKey&#39;,
        Value =&#62; &#39;Some Value&#39;,
        TTL   =&#62; 60 * 60 * 24 * 20, # seconds, this means 20 days
    );</pre>

<p>The Type here refers to the group of entries that should be cached and cleaned up together, usually this will represent the OTRS object that is supposed to be cached, like &#39;Ticket&#39;.</p>

<p>The Key identifies the entry (together with the type) for retrieval and deletion of this value.</p>

<p>The <code>TTL</code> controls when the cache will expire. Please note that the in-memory cache is not persistent and thus has no <code>TTL</code>/expiry mechanism.</p>

<p>Please note that if you store complex data, you have to make sure that the data is not modified in other parts of the code as the in-memory cache only refers to it. Otherwise also the cache would contain the modifications. If you cannot avoid this, you can disable the in-memory cache for this value:</p>

<pre>    $CacheObject-&#62;Set(
        Type  =&#62; &#39;ObjectName&#39;,
        Key   =&#62; &#39;SomeKey&#39;,
        Value =&#62; { ... complex data ... },

        TTL            =&#62; 60 * 60 * 24 * 1,  # optional, default 20 days
        CacheInMemory  =&#62; 0,                 # optional, defaults to 1
        CacheInBackend =&#62; 1,                 # optional, defaults to 1
    );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Get()"
><a name='//apple_ref/cpp/Function/Get()' class='dashAnchor'></a>Get()</a></h2>

<p>fetch a value from the cache.</p>

<pre>    my $Value = $CacheObject-&#62;Get(
        Type =&#62; &#39;ObjectName&#39;,       # only [a-zA-Z0-9_] chars usable
        Key  =&#62; &#39;SomeKey&#39;,
    );</pre>

<p>Please note that if you store complex data, you have to make sure that the data is not modified in other parts of the code as the in-memory cache only refers to it. Otherwise also the cache would contain the modifications. If you cannot avoid this, you can disable the in-memory cache for this value:</p>

<pre>    my $Value = $CacheObject-&#62;Get(
        Type =&#62; &#39;ObjectName&#39;,
        Key  =&#62; &#39;SomeKey&#39;,

        CacheInMemory =&#62; 0,     # optional, defaults to 1
        CacheInBackend =&#62; 1,    # optional, defaults to 1
    );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Delete()"
><a name='//apple_ref/cpp/Function/Delete()' class='dashAnchor'></a>Delete()</a></h2>

<p>deletes a single value from the cache.</p>

<pre>    $CacheObject-&#62;Delete(
        Type =&#62; &#39;ObjectName&#39;,       # only [a-zA-Z0-9_] chars usable
        Key  =&#62; &#39;SomeKey&#39;,
    );</pre>

<p>Please note that despite the cache configuration, Delete and CleanUp will always be executed both in memory and in the backend to avoid inconsistent cache states.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="CleanUp()"
><a name='//apple_ref/cpp/Function/CleanUp()' class='dashAnchor'></a>CleanUp()</a></h2>

<p>delete parts of the cache or the full cache data.</p>

<p>To delete the whole cache:</p>

<pre>    $CacheObject-&#62;CleanUp();</pre>

<p>To delete the data of only one cache type:</p>

<pre>    $CacheObject-&#62;CleanUp(
        Type =&#62; &#39;ObjectName&#39;,   # only [a-zA-Z0-9_] chars usable
    );</pre>

<p>To delete all data except of some types:</p>

<pre>    $CacheObject-&#62;CleanUp(
        KeepTypes =&#62; [&#39;Object1&#39;, &#39;Object2&#39;],
    );</pre>

<p>To delete only expired cache data:</p>

<pre>    $CacheObject-&#62;CleanUp(
        Expired =&#62; 1,   # optional, defaults to 0
    );</pre>

<p>Type/KeepTypes and Expired can be combined to only delete expired data of a single type or of all types except the types to keep.</p>

<p>Please note that despite the cache configuration, Delete and CleanUp will always be executed both in memory and in the backend to avoid inconsistent cache states.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="TERMS_AND_CONDITIONS"
><a name='//apple_ref/cpp/Class/TERMS AND CONDITIONS' class='dashAnchor'></a>TERMS AND CONDITIONS</a></h1>

<p>This software is part of the OTRS project (<a href="https://otrs.org/" class="podlinkurl"
>https://otrs.org/</a>).</p>

<p>This software comes with ABSOLUTELY NO WARRANTY. For details, see the enclosed file COPYING for license information (GPL). If you did not receive this file, see <a href="https://www.gnu.org/licenses/gpl-3.0.txt" class="podlinkurl"
>https://www.gnu.org/licenses/gpl-3.0.txt</a>.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
